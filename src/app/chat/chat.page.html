<ion-header [translucent]="false" class="bg-white no-shadow">
  <ion-toolbar class="bg-white" style="--background:#fff; --border-color: var(--color-brand-100); --border-width: 0 0 1px 0; box-shadow:none; -webkit-box-shadow:none;">
    <div class="px-4 pt-5 pb-3">
      <div class="flex w-full items-center gap-3">
        <ion-button
          fill="clear"
          class="m-0 h-9 w-9 rounded-full bg-[color:var(--color-neutral-300)] text-neutral-800"
          (click)="handleBack()"
        >
          <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
        </ion-button>

        <span
          class="inline-flex h-8 w-8 items-center justify-center rounded-full text-base"
          [style.background]="headerColor"
          [style.color]="'#fff'"
        >
          {{ headerEmoji || 'ðŸ¤–' }}
        </span>

        <div class="flex min-w-0 flex-col leading-tight">
          <span class="truncate text-[16px] font-semibold text-neutral-900">{{ headerTitle || 'Chatbot' }}</span>
          <span *ngIf="headerSubtitle" class="truncate text-[11px] text-brand-700">{{ headerSubtitle }}</span>
        </div>

        <ion-button
          fill="clear"
          class="ml-auto m-0 h-9 w-9 rounded-full bg-[color:var(--color-neutral-300)] text-neutral-800"
          (click)="openOptions()"
        >
          <ion-icon name="ellipsis-horizontal" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="false" class="bg-white">
  <!-- Settings panel removed from UI (configurada en TS) -->
  <div class="px-4 py-3 space-y-3">
    <div
      *ngFor="let msg of messages"
      class="flex"
      [class.justify-end]="msg.from === 'user'"
      [class.justify-start]="msg.from !== 'user'"
    >
      <div
        class="inline-block max-w-[85%] rounded-2xl px-4 py-2 ring-1"
        [class.bg-primary]="msg.from === 'user'"
        [class.text-white]="msg.from === 'user'"
        [class.ring-transparent]="msg.from === 'user'"
        [class.rounded-br-none]="msg.from === 'user'"
        [class.bg-white]="msg.from !== 'user'"
        [class.text-neutral-800]="msg.from !== 'user'"
        [class.ring-brand-100]="msg.from !== 'user'"
        [class.rounded-bl-none]="msg.from !== 'user'"
      >
        <div class="prose prose-sm max-w-none prose-headings:mt-2 prose-p:my-2 prose-pre:my-2 prose-code:before:content-[''] prose-code:after:content-['']" [innerHTML]="renderMarkdown(msg.text)"></div>
        <span class="block text-[11px] opacity-75 mt-1">{{ msg.time }}</span>
      </div>
    </div>
  </div>

</ion-content>

<ion-footer class="bg-white no-shadow" [style.box-shadow]="'none'" [style.border-top]="'0'" [style.--border-color]="'transparent'" [style.filter]="'none'">
  <div class="px-4 pt-3 pb-[calc(var(--ion-safe-area-bottom,env(safe-area-inset-bottom))+14px)]">
    <div class="mx-auto flex max-w-sm items-center gap-3">
      <!-- Clear button (black) -->
      <ion-button
        fill="solid"
        (click)="clearChat()"
        [style.--border-radius]="'9999px'"
        [style.--padding-start]="'0'"
        [style.--padding-end]="'0'"
        [style.--padding-top]="'0'"
        [style.--padding-bottom]="'0'"
        [style.--background]="'var(--color-brand-900)'"
        [style.width]="'44px'"
        [style.height]="'44px'"
      >
        <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
      </ion-button>

      <!-- Input pill -->
      <div class="flex h-[44px] flex-1 items-center rounded-full bg-neutral-300 px-4 transition-colors border border-transparent focus-within:border-[color:var(--color-brand-100)]">
        <ion-input
          [(ngModel)]="draft"
          [clearInput]="true"
          placeholder="Escribe un mensaje..."
          class="w-full bg-transparent"
          [style.--highlight-color-focused]="'transparent'"
          [style.--highlight-color]="'transparent'"
          [style.--border-color]="'transparent'"
          enterkeyhint="send"
          (keyup.enter)="sendMessage()"
        ></ion-input>
      </div>

      <!-- Send circular -->
      <ion-button
        (click)="sendMessage()"
        [disabled]="!(draft && draft.trim()) || isSending"
        [style.--border-radius]="'9999px'"
        [style.--padding-start]="'0'"
        [style.--padding-end]="'0'"
        [style.--padding-top]="'0'"
        [style.--padding-bottom]="'0'"
        [style.--background]="'var(--color-primary)'"
        [style.width]="'44px'"
        [style.height]="'44px'"
      >
        <ion-icon name="send" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>

</ion-footer>
